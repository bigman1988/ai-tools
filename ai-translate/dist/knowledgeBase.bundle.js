(()=>{var n,e={3:()=>{},365:(n,e,t)=>{"use strict";t.d(e,{A:()=>s});var o=t(601),r=t.n(o),i=t(314),l=t.n(i)()(r());l.push([n.id,"body {\n    margin: 0;\n    padding: 0;\n    font-family: Arial, sans-serif;\n    background-color: #f5f5f5;\n}\n\n.app-container {\n    display: flex;\n    width: 100%;\n    height: 100vh;\n}\n\n.sidebar {\n    width: 17%;\n    padding: 0px;\n    background-color: #f8f9fa;\n    border-right: 1px solid #dee2e6;\n    overflow-y: auto;\n    display: flex;\n    flex-direction: column;\n}\n\n.main-content {\n    width: 83%;\n    padding: 0px;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n.file-input-container {\n    margin: 0px 10px 0px 10px;\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n    flex-shrink: 0;\n}\n\n.button-group {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    margin: 0px 0px;\n}\n\n.action-buttons-row {\n    display: flex;\n    gap: 10px;\n    width: 100%;\n}\n\n.action-buttons-row .btn {\n    flex: 1;\n}\n\n.source-lang-selector {\n    margin: 10px;\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n.select-input {\n    flex: 1;\n    padding: 5px;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n}\n\n.log-container {\n    margin-top: 5px;\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    min-height: 0;\n}\n\n.log-container h3 {\n    margin: 0 0 10px 0;\n    flex-shrink: 0;\n}\n\n.log-output {\n    flex: 1;\n    width: 99%;\n    height: 200px;\n    overflow-y: auto;\n    overflow-x: hidden;\n    background-color: #f8f9fa;\n    border: 1px solid #e9ecef;\n    border-radius: 4px;\n    padding: 0px;\n    font-family: monospace;\n    font-size: 12px;\n}\n\n.excel-table-container {\n    width: 100%;\n    height: 100%;\n    overflow: auto;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n    background-color: white;\n    flex: 1;\n}\n\n.table-output {\n    width: 100%;\n    height: 100%;\n    background-color: white;\n}\n\n.excel-table {\n    width: 100%;\n    border-collapse: collapse;\n    table-layout: fixed; /* 使用固定表格布局，确保单元格宽度限制生效 */\n    min-width: 100%;\n    border-spacing: 0; /* 消除单元格间的间距 */\n}\n\n/* 第一列（行号列）的样式 */\n.excel-table td:first-child,\n.excel-table th:first-child {\n    min-width: 50px;\n    max-width: 80px;\n    text-align: center;\n    background-color: #f8f9fa;\n}\n\n.excel-table th,\n.excel-table td {\n    border: 1px solid #ddd;\n    padding: 8px;\n    text-align: left;\n    min-width: 100px;\n    max-width: 200px; /* 设置最大宽度为200px */\n    width: 200px; /* 固定宽度为200px */\n    white-space: normal;\n    word-wrap: break-word;\n    word-break: break-word; /* 允许在单词内部换行 */\n    overflow: visible; /* 改为可见，确保内容不被裁剪 */\n    height: auto !important; /* 高度自动调整，使用!important确保优先级 */\n    vertical-align: top; /* 内容顶部对齐 */\n    line-height: 1.5; /* 增加行高，使文本更易读 */\n    box-sizing: border-box; /* 确保内边距和边框不会增加元素宽度 */\n}\n\n.excel-table th {\n    background-color: #f8f9fa;\n    font-weight: bold;\n    position: sticky;\n    top: 0;\n    z-index: 10; /* 增加z-index确保表头始终在最上层 */\n    box-shadow: 0 2px 2px -1px rgba(0,0,0,0.1); /* 添加阴影增强视觉效果 */\n}\n\n.excel-table tr:nth-child(even) {\n    background-color: #f8f9fa;\n}\n\n.excel-table tr:hover {\n    background-color: #f5f5f5;\n}\n\n.upload-section {\n    border: 2px dashed #ccc;\n    padding: 20px;\n    text-align: center;\n    border-radius: 8px;\n    transition: all 0.3s ease;\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n}\n\n.upload-section.drag-over {\n    border-color: #2196F3;\n    background-color: rgba(33, 150, 243, 0.1);\n}\n\n.upload-hint {\n    color: #666;\n    margin: 0;\n    font-size: 14px;\n    transition: all 0.3s ease;\n}\n\n.upload-section.has-file .upload-hint {\n    font-size: 12px;\n    color: #999;\n}\n\n.file-name {\n    margin: 10px 0;\n    font-size: 14px;\n    color: #666;\n}\n\n/* 源语言选择器样式 */\n.source-lang-selector label {\n    color: #333;\n    font-size: 14px;\n    min-width: 70px;\n}\n\n/* 添加样式使单元格内容过多时能正确显示 */\n.excel-table tr {\n    height: auto !important; /* 行高自动调整 */\n}\n\n/* 确保长文本在单元格中正确换行 */\n.excel-table td div,\n.excel-table td span,\n.excel-table td p,\n.excel-table td {\n    max-width: 100%;\n    word-wrap: break-word;\n    word-break: break-word;\n    white-space: pre-wrap; /* 保留空白并允许换行 */\n    text-overflow: ellipsis; /* 文本过长时显示省略号 */\n}\n\n.select-input {\n    flex: 1;\n    padding: 8px 12px;\n    border: 1px solid #2196F3;\n    border-radius: 4px;\n    font-size: 14px;\n    color: #333;\n    background-color: white;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\n.select-input:hover {\n    border-color: #1976D2;\n}\n\n.select-input:focus {\n    outline: none;\n    border-color: #1976D2;\n    box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.1);\n}\n\n/* 按钮基础样式 */\n.btn {\n    padding: 8px 16px;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    background-color: #2196F3;\n    color: white;\n    transition: background-color 0.3s;\n}\n\n.btn:hover {\n    background-color: #1976D2;\n}\n\n.btn:active {\n    background-color: #1565C0;\n}\n\n.btn:disabled {\n    background-color: #cccccc;\n    cursor: not-allowed;\n}\n\n/* 停止按钮样式 */\n.stop-btn {\n    background-color: #dc3545;\n    color: white;\n}\n\n.stop-btn:hover {\n    background-color: #c82333;\n}\n\n/* 翻译按钮样式 */\n.translate-btn {\n    padding: 8px 16px;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    background-color: #4CAF50;\n    color: white;\n    transition: background-color 0.3s;\n}\n\n.translate-btn:hover {\n    background-color: #45a049;\n}\n\n.translate-btn:disabled {\n    background-color: #cccccc;\n    cursor: not-allowed;\n}\n\n/* 保存按钮样式 */\n#saveBtn, #saveJson {\n    background-color: #4CAF50;\n}\n\n#saveBtn:hover, #saveJson:hover {\n    background-color: #388E3C;\n}\n\n#saveExcel {\n    background-color: #4CAF50;\n}\n\n#saveExcel:hover {\n    background-color: #388E3C;\n}\n\n/* 进度条容器样式 */\n.progress-wrapper {\n    margin: 5px;\n    width: 95%;\n}\n\n.progress-container {\n    width: 100%;\n    height: 20px;\n    background-color: #f0f0f0;\n    border-radius: 4px;\n    overflow: hidden;\n    border: 1px solid #ddd;\n    position: relative;\n}\n\n.progress-fill {\n    height: 100%;\n    width: 0;\n    background-color: #4CAF50;\n    transition: width 0.3s ease;\n}\n\n.progress-text {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n    color: #333;\n    font-size: 12px;\n    z-index: 1;\n}\n\n.progress-details {\n    margin-top: 5px;\n    font-size: 12px;\n    color: #666;\n    text-align: center;\n}\n\n.log-container h3 {\n    margin: 0 0 10px 0;\n    color: #333;\n    font-size: 14px;\n}\n\n.log-entry {\n    margin: 5px 0;\n    padding: 5px;\n    border-radius: 3px;\n    word-wrap: break-word;\n}\n\n.log-entry .timestamp {\n    color: #666;\n    margin-right: 8px;\n}\n\n.log-entry.error {\n    color: #dc3545;\n    background-color: rgba(220, 53, 69, 0.1);\n}\n\n.log-entry.warning {\n    color: #ffc107;\n    background-color: rgba(255, 193, 7, 0.1);\n}\n\n.log-entry.success {\n    color: #28a745;\n    background-color: rgba(40, 167, 69, 0.1);\n}\n\n.excel-table th {\n    background-color: #f8f9fa;\n    font-weight: bold;\n}\n\n.excel-table tr:nth-child(even) {\n    background-color: #f8f9fa;\n}\n\n.excel-table tr:hover {\n    background-color: #f5f5f5;\n}\n\n.table-scroll-container {\n    width: 100%;\n    height: 100%;\n    overflow: auto;\n}\n\n.table-scroll-x {\n    width: 100%;\n    overflow-x: auto;\n}\n\n.table-scroll-y {\n    height: 100%;\n    overflow-y: auto;\n}\n\n.container {\n    display: flex;\n    flex-direction: column;\n    min-height: 100vh;\n    padding: 20px;\n    box-sizing: border-box;\n}\n\n.content-wrapper {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n}\n\n.timestamp {\n    color: #666;\n    font-size: 0.9em;\n    margin-right: 8px;\n}\n\n.error {\n    color: #cc0000;\n    padding: 10px;\n    margin: 10px 0;\n    background-color: #ffe8e8;\n    border: 1px solid #ffcccc;\n    border-radius: 4px;\n}\n\n.progress-container {\n    margin: 10px 0;\n    width: 100%;\n}\n\n.progress-bar {\n    width: 100%;\n    height: 20px;\n    background-color: #f0f0f0;\n    border-radius: 10px;\n    overflow: hidden;\n}\n\n.progress {\n    height: 100%;\n    background-color: #4CAF50;\n    transition: width 0.3s ease-in-out;\n}\n\n.progress-text {\n    margin-top: 5px;\n    text-align: center;\n    color: #666;\n    font-size: 14px;\n}\n",""]);const s=l},922:(n,e,t)=>{"use strict";var o=t(72),r=t.n(o),i=t(825),l=t.n(i),s=t(659),a=t.n(s),c=t(56),d=t.n(c),h=t(540),u=t.n(h),p=t(113),g=t.n(p),b=t(365),f={};f.styleTagTransform=g(),f.setAttributes=d(),f.insert=a().bind(null,"head"),f.domAPI=l(),f.insertStyleElement=u(),r()(b.A,f),b.A&&b.A.locals&&b.A.locals;var m=function(n,e,t,o){return new(t||(t=Promise))((function(r,i){function l(n){try{a(o.next(n))}catch(n){i(n)}}function s(n){try{a(o.throw(n))}catch(n){i(n)}}function a(n){var e;n.done?r(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(l,s)}a((o=o.apply(n,e||[])).next())}))};const y=new class{constructor(){this.baseUrl="http://localhost:3000/api"}getStatus(){return m(this,void 0,void 0,(function*(){try{const n=yield fetch(`${this.baseUrl}/status`);if(!n.ok)throw new Error(`服务器响应错误: ${n.status}`);return yield n.json()}catch(n){throw console.error("获取服务器状态失败:",n),n}}))}getEntries(n){return m(this,arguments,void 0,(function*(n,e=100,t=0){try{let o=`${this.baseUrl}/entries?limit=${e}&offset=${t}`;n&&(o+=`&search=${encodeURIComponent(n)}`);const r=yield fetch(o);if(!r.ok)throw new Error(`获取条目失败: ${r.status}`);return yield r.json()}catch(n){throw console.error("获取条目失败:",n),n}}))}addEntry(n){return m(this,void 0,void 0,(function*(){try{const e=yield fetch(`${this.baseUrl}/entries`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!e.ok)throw new Error(`添加条目失败: ${e.status}`);return(yield e.json()).success}catch(n){throw console.error("添加条目失败:",n),n}}))}updateEntry(n,e){return m(this,void 0,void 0,(function*(){try{const t=yield fetch(`${this.baseUrl}/entries/${encodeURIComponent(n)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`更新条目失败: ${t.status}`);return(yield t.json()).success}catch(n){throw console.error("更新条目失败:",n),n}}))}deleteEntry(n){return m(this,void 0,void 0,(function*(){try{console.log(`API服务 - 删除条目，原始ID: "${n}"`);const e=yield fetch(`${this.baseUrl}/entries/delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n})});if(!e.ok){const n=yield e.json();throw console.error("删除条目失败:",n),new Error(`删除条目失败: ${e.status}`)}const t=yield e.json();return console.log("删除条目成功:",t),!0}catch(n){throw console.error("删除条目出错:",n),n}}))}importExcel(n){return m(this,void 0,void 0,(function*(){try{const e=new FormData;e.append("file",n);const t=yield fetch(`${this.baseUrl}/import`,{method:"POST",body:e});if(!t.ok)throw new Error(`导入Excel失败: ${t.status}`);return yield t.json()}catch(n){throw console.error("导入Excel失败:",n),n}}))}exportExcel(){return m(this,void 0,void 0,(function*(){try{const n=yield fetch(`${this.baseUrl}/export`);if(!n.ok)throw new Error(`导出Excel失败: ${n.status}`);return yield n.blob()}catch(n){throw console.error("导出Excel失败:",n),n}}))}initializeDatabase(){return m(this,void 0,void 0,(function*(){try{yield this.getStatus(),console.log("API服务器连接成功")}catch(n){throw console.error("API服务器连接失败:",n),new Error("无法连接到API服务器，请确保服务器已启动")}}))}};var x=t(451);function v(n){return n?n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}const E=[{key:"Chinese",label:"中文"},{key:"English",label:"英文"},{key:"Japanese",label:"日文"},{key:"Korean",label:"韩文"},{key:"Spanish",label:"西班牙文"},{key:"French",label:"法文"},{key:"German",label:"德文"},{key:"Russian",label:"俄文"},{key:"Thai",label:"泰文"},{key:"Italian",label:"意大利文"},{key:"Indonesian",label:"印尼文"},{key:"Portuguese",label:"葡萄牙文"}];var w=function(n,e,t,o){return new(t||(t=Promise))((function(r,i){function l(n){try{a(o.next(n))}catch(n){i(n)}}function s(n){try{a(o.throw(n))}catch(n){i(n)}}function a(n){var e;n.done?r(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(l,s)}a((o=o.apply(n,e||[])).next())}))};class k{constructor(n){this.manager=n}showEntryDetails(n){const e=document.createElement("div");e.className="modal";let t='\n            <div class="modal-content">\n                <span class="close">&times;</span>\n                <h2>查看翻译条目</h2>\n                <div class="entry-details">\n        ';E.forEach((e=>{const o=n[e.key];t+=`\n                <div class="entry-field">\n                    <label>${e.label}:</label>\n                    <div class="field-value">${v((null==o?void 0:o.toString())||"")}</div>\n                </div>\n            `})),t+="\n                </div>\n            </div>\n        ",e.innerHTML=t,document.body.appendChild(e);const o=e.querySelector(".close");o&&o.addEventListener("click",(()=>{document.body.removeChild(e)}))}showEditEntryForm(n){const e=document.createElement("div");e.className="modal";let t=`\n            <div class="modal-content">\n                <span class="close">&times;</span>\n                <h2>编辑翻译条目</h2>\n                <form id="editEntryForm">\n                    <input type="hidden" id="entryChinese" value="${n.Chinese}">\n        `;E.forEach((e=>{const o=n[e.key];t+=`\n                <div class="form-group">\n                    <label for="${e.key}">${e.label}:</label>\n                    <textarea id="${e.key}" class="form-control" rows="2">${v((null==o?void 0:o.toString())||"")}</textarea>\n                </div>\n            `})),t+='\n                    <div class="form-group">\n                        <button type="submit" class="btn">保存</button>\n                        <button type="button" class="btn cancel-btn">取消</button>\n                    </div>\n                </form>\n            </div>\n        ',e.innerHTML=t,document.body.appendChild(e);const o=e.querySelector(".close"),r=e.querySelector(".cancel-btn"),i=()=>{document.body.removeChild(e)};o&&o.addEventListener("click",i),r&&r.addEventListener("click",i),e.querySelector("#editEntryForm").addEventListener("submit",(n=>w(this,void 0,void 0,(function*(){n.preventDefault();const t=document.getElementById("entryChinese").value,o={};E.forEach((n=>{const e=document.getElementById(n.key);o[n.key]=e.value}));try{yield y.updateEntry(t,o),this.manager.log("条目更新成功","info"),document.body.removeChild(e),yield this.manager.loadEntries()}catch(n){this.manager.log(`更新失败: ${n.message}`,"error")}}))))}showAddEntryForm(){const n=document.createElement("div");n.className="modal";let e='\n            <div class="modal-content">\n                <span class="close">&times;</span>\n                <h2>添加翻译条目</h2>\n                <form id="addEntryForm">\n        ';E.forEach((n=>{e+=`\n                <div class="form-group">\n                    <label for="${n.key}">${n.label}:</label>\n                    <textarea id="${n.key}" class="form-control" rows="2"></textarea>\n                </div>\n            `})),e+='\n                    <div class="form-group">\n                        <button type="submit" class="btn">保存</button>\n                        <button type="button" class="btn cancel-btn">取消</button>\n                    </div>\n                </form>\n            </div>\n        ',n.innerHTML=e,document.body.appendChild(n);const t=n.querySelector(".close"),o=n.querySelector(".cancel-btn"),r=()=>{document.body.removeChild(n)};t&&t.addEventListener("click",r),o&&o.addEventListener("click",r),n.querySelector("#addEntryForm").addEventListener("submit",(e=>w(this,void 0,void 0,(function*(){e.preventDefault();const t={};E.forEach((n=>{const e=document.getElementById(n.key);t[n.key]=e.value}));try{yield y.addEntry(t),this.manager.log("条目添加成功","info"),document.body.removeChild(n),yield this.manager.loadEntries()}catch(n){this.manager.log(`添加失败: ${n.message}`,"error")}}))))}}class ${constructor(n,e,t){this.currentEntries=[],this.container=n,this.manager=e,this.modals=new k(e),this.deleteEntryCallback=t}renderTable(n){if(this.currentEntries=n,!this.container)return;this.container.innerHTML='\n            <div class="table-wrapper">\n                <table class="kb-table">\n                    <thead>\n                        <tr>\n                            <th class="checkbox-cell"><input type="checkbox" id="selectAll"></th>\n                            <th>中文</th>\n                            <th>英文</th>\n                            <th>日文</th>\n                            <th>韩文</th>\n                            <th>西班牙文</th>\n                            <th>法文</th>\n                            <th>德文</th>\n                            <th>俄文</th>\n                            <th>泰文</th>\n                            <th>意大利文</th>\n                            <th>印尼文</th>\n                            <th>葡萄牙文</th>\n                            <th>操作</th>\n                        </tr>\n                    </thead>\n                    <tbody id="entriesTableBody">\n                    </tbody>\n                </table>\n            </div>\n        ';const e=document.getElementById("entriesTableBody");e&&(n.forEach(((n,t)=>{const o=document.createElement("tr");o.innerHTML=`\n                <td class="checkbox-cell"><input type="checkbox" class="entry-checkbox" data-id="${n.Chinese}"></td>\n                <td>${v(n.Chinese||"")}</td>\n                <td>${v(n.English||"")}</td>\n                <td>${v(n.Japanese||"")}</td>\n                <td>${v(n.Korean||"")}</td>\n                <td>${v(n.Spanish||"")}</td>\n                <td>${v(n.French||"")}</td>\n                <td>${v(n.German||"")}</td>\n                <td>${v(n.Russian||"")}</td>\n                <td>${v(n.Thai||"")}</td>\n                <td>${v(n.Italian||"")}</td>\n                <td>${v(n.Indonesian||"")}</td>\n                <td>${v(n.Portuguese||"")}</td>\n                <td>\n                    <button class="btn-small view-btn" data-id="${n.Chinese}">查看</button>\n                    <button class="btn-small edit-btn" data-id="${n.Chinese}">编辑</button>\n                    <button class="btn-small delete-btn" data-id="${n.Chinese}">删除</button>\n                </td>\n            `,e.appendChild(o)})),this.initializeTableEvents())}initializeTableEvents(){const n=document.getElementById("selectAll");n&&n.addEventListener("change",(()=>{document.querySelectorAll(".entry-checkbox").forEach((e=>{e.checked=n.checked}))})),document.querySelectorAll(".view-btn").forEach((n=>{n.addEventListener("click",(()=>{const e=n.getAttribute("data-id")||"",t=this.currentEntries.find((n=>n.Chinese===e));t&&this.modals.showEntryDetails(t)}))})),document.querySelectorAll(".edit-btn").forEach((n=>{n.addEventListener("click",(()=>{const e=n.getAttribute("data-id")||"",t=this.currentEntries.find((n=>n.Chinese===e));t&&this.modals.showEditEntryForm(t)}))})),document.querySelectorAll(".delete-btn").forEach((n=>{n.addEventListener("click",(()=>{return e=this,t=void 0,r=function*(){const e=n.getAttribute("data-id")||"";yield this.deleteEntryCallback(e)},new((o=void 0)||(o=Promise))((function(n,i){function l(n){try{a(r.next(n))}catch(n){i(n)}}function s(n){try{a(r.throw(n))}catch(n){i(n)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(n){n(t)}))).then(l,s)}a((r=r.apply(e,t||[])).next())}));var e,t,o,r}))}))}getSelectedEntryIds(){const n=[];return document.querySelectorAll(".entry-checkbox:checked").forEach((e=>{const t=e.getAttribute("data-id")||"";t&&n.push(t)})),n}showAddEntryForm(){this.modals.showAddEntryForm()}}var I=function(n,e,t,o){return new(t||(t=Promise))((function(r,i){function l(n){try{a(o.next(n))}catch(n){i(n)}}function s(n){try{a(o.throw(n))}catch(n){i(n)}}function a(n){var e;n.done?r(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(l,s)}a((o=o.apply(n,e||[])).next())}))};class C{constructor(){var n;this.currentEntries=[],this.selectedSourceLang="zh-CN",this.initializeDOMElements(),this.logFunction=(n=this.logOutput,function(e,t="info"){if(!n)return;const o=document.createElement("div");o.className=`log-entry ${t}`,o.textContent=e,n.appendChild(o),n.scrollTop=n.scrollHeight}),this.tableRenderer=new $(this.kbTableOutput,this,this.deleteEntry.bind(this)),window.knowledgeBaseManagerInstance?console.log("检测到已存在实例，跳过事件监听器初始化"):(this.initializeEventListeners(),this.initializeDatabase(),console.log("初始化事件监听器"))}initializeDOMElements(){this.fileInput=document.getElementById("fileInput"),this.fileName=document.getElementById("fileName"),this.uploadBtn=document.getElementById("uploadBtn"),this.importBtn=document.getElementById("importBtn"),this.actionButtons=document.getElementById("actionButtons"),this.logOutput=document.getElementById("logOutput"),this.progressFill=document.getElementById("progressFill"),this.progressText=document.getElementById("progressText"),this.progressDetails=document.getElementById("progressDetails"),this.searchInput=document.getElementById("searchInput"),this.searchBtn=document.getElementById("searchBtn"),this.kbTableOutput=document.getElementById("kbTableOutput"),this.addEntryBtn=document.getElementById("addEntryBtn"),this.deleteSelectedBtn=document.getElementById("deleteSelectedBtn"),this.sourceLang=document.getElementById("sourceLang")}initializeDatabase(){return I(this,void 0,void 0,(function*(){try{yield this.loadEntries(),this.log("数据库连接成功")}catch(n){this.log(`数据库连接失败: ${n.message}`,"error")}}))}initializeEventListeners(){this.fileInput.addEventListener("change",(n=>{const e=n.target.files;if(e&&e.length>0){const n=e[0];this.fileName.textContent=n.name,this.actionButtons.style.display="block"}})),this.uploadBtn.addEventListener("click",(()=>{this.fileInput.click()})),this.importBtn.addEventListener("click",(()=>I(this,void 0,void 0,(function*(){try{const n=this.fileInput.files;if(!n||0===n.length)return void this.log("请先选择文件","error");const e=n[0];this.log(`开始处理Excel文件: ${e.name}`),this.processExcelFile(e),this.progressFill.style.width="0%",this.progressText.textContent="0%",this.progressDetails.textContent="准备导入...",this.progressDetails.style.display="block",this.selectedSourceLang=this.sourceLang.value,setTimeout((()=>{const n=this.currentEntries;if(0===n.length)return void this.log("没有数据可导入","error");this.log(`开始导入 ${n.length} 条记录`);let e=0,t=0;const o=r=>I(this,void 0,void 0,(function*(){if(r>=n.length)return this.log(`导入完成，成功: ${e}，失败: ${t}`),void(yield this.loadEntries());const i=Math.min(r+10,n.length),l=n.slice(r,i);try{yield Promise.all(l.map((n=>y.addEntry(n)))),e+=l.length}catch(n){t+=l.length,this.log(`批量导入失败: ${n.message}`,"error")}const s=Math.round(i/n.length*100);this.progressFill.style.width=`${s}%`,this.progressText.textContent=`${s}%`,this.progressDetails.textContent=`已处理 ${i} / ${n.length} 条记录`,setTimeout((()=>o(i)),0)}));o(0)}),500)}catch(n){this.log(`导入失败: ${n.message}`,"error")}})))),this.searchBtn.addEventListener("click",(()=>{const n=this.searchInput.value.trim();this.loadEntries(n)})),this.searchInput.addEventListener("keypress",(n=>{if("Enter"===n.key){const n=this.searchInput.value.trim();this.loadEntries(n)}})),this.addEntryBtn.addEventListener("click",(()=>{this.tableRenderer.showAddEntryForm()})),this.deleteSelectedBtn.addEventListener("click",(()=>I(this,void 0,void 0,(function*(){const n=this.tableRenderer.getSelectedEntryIds();if(0!==n.length){if(confirm(`确定要删除选中的 ${n.length} 条记录吗？`))try{let e=0,t=0;for(const o of n)try{console.log(`原始ID: "${o}"`);const n=o.replace(/[\r\n]+/g," ").trim();console.log(`处理后ID: "${n}"`),(yield y.deleteEntry(n))?e++:(t++,this.log(`删除失败: ${n}`,"error"))}catch(n){t++,this.log(`删除失败 "${o}": ${n.message}`,"error")}this.log(`批量删除完成，成功: ${e}，失败: ${t}`),yield this.loadEntries()}catch(n){this.log(`批量删除失败: ${n.message}`,"error")}}else this.log("请先选择要删除的条目","error")}))))}loadEntries(n){return I(this,void 0,void 0,(function*(){try{const e=yield y.getEntries(n);this.currentEntries=e,this.tableRenderer.renderTable(e),n?this.log(`搜索结果: ${e.length} 条记录`):this.log(`加载了 ${e.length} 条记录`)}catch(n){this.log(`加载失败: ${n.message}`,"error")}}))}deleteEntry(n){return I(this,void 0,void 0,(function*(){if(confirm("确定要删除这条记录吗？"))try{(yield y.deleteEntry(n))?(this.log("删除成功"),yield this.loadEntries()):this.log("删除失败","error")}catch(n){this.log(`删除失败: ${n.message}`,"error")}}))}processExcelFile(n){const e=new FileReader;e.onload=n=>{var e;try{const t=new Uint8Array(null===(e=n.target)||void 0===e?void 0:e.result),o=x.read(t,{type:"array"}),r=o.SheetNames[0],i=o.Sheets[r],l=x.utils.sheet_to_json(i,{header:1});this.processExcelData(l)}catch(n){this.log(`Excel文件处理失败: ${n.message}`,"error")}},e.onerror=()=>{this.log("文件读取失败","error")},e.readAsArrayBuffer(n)}processExcelData(n){try{if(!n||n.length<7)return void this.log("Excel文件格式不正确，至少需要7行数据","error");const e=n[1],t={简体中文:"Chinese",英语:"English",日语:"Japanese",韩语:"Korean",西班牙语:"Spanish",法语:"French",德语:"German",俄语:"Russian",泰语:"Thai",意大利语:"Italian",印尼语:"Indonesian",葡萄牙语:"Portuguese"},o={};if(e.forEach(((n,e)=>{const r=t[n];r&&(o[r]=e)})),!o.Chinese)return void this.log("Excel文件缺少必要的表头：简体中文","error");const r=[];for(let e=6;e<n.length;e++){const t=n[e];if(!t||0===t.length)continue;const i={};Object.entries(o).forEach((([n,e])=>{e<t.length&&(i[n]=t[e]||"")})),i.Chinese&&r.push(i)}this.currentEntries=r,this.tableRenderer.renderTable(r),this.log(`成功解析 ${r.length} 条记录`)}catch(n){this.log(`数据处理失败: ${n.message}`,"error")}}log(n,e="info"){this.logFunction(n,e)}}document.addEventListener("DOMContentLoaded",(()=>{window.knowledgeBaseManagerInstance=new C}))}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={id:n,exports:{}};return e[n].call(i.exports,i,i.exports,o),i.exports}o.m=e,n=[],o.O=(e,t,r,i)=>{if(!t){var l=1/0;for(d=0;d<n.length;d++){for(var[t,r,i]=n[d],s=!0,a=0;a<t.length;a++)(!1&i||l>=i)&&Object.keys(o.O).every((n=>o.O[n](t[a])))?t.splice(a--,1):(s=!1,i<l&&(l=i));if(s){n.splice(d--,1);var c=r();void 0!==c&&(e=c)}}return e}i=i||0;for(var d=n.length;d>0&&n[d-1][2]>i;d--)n[d]=n[d-1];n[d]=[t,r,i]},o.n=n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return o.d(e,{a:e}),e},o.d=(n,e)=>{for(var t in e)o.o(e,t)&&!o.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})},o.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),(()=>{var n={450:0};o.O.j=e=>0===n[e];var e=(e,t)=>{var r,i,[l,s,a]=t,c=0;if(l.some((e=>0!==n[e]))){for(r in s)o.o(s,r)&&(o.m[r]=s[r]);if(a)var d=a(o)}for(e&&e(t);c<l.length;c++)i=l[c],o.o(n,i)&&n[i]&&n[i][0](),n[i]=0;return o.O(d)},t=self.webpackChunkexcel_to_structured_data=self.webpackChunkexcel_to_structured_data||[];t.forEach(e.bind(null,0)),t.push=e.bind(null,t.push.bind(t))})(),o.nc=void 0;var r=o.O(void 0,[121],(()=>o(922)));r=o.O(r)})();