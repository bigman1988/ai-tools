(()=>{var n,t={3:()=>{},365:(n,t,e)=>{"use strict";e.d(t,{A:()=>a});var o=e(1601),r=e.n(o),s=e(6314),i=e.n(s)()(r());i.push([n.id,"body {\n    margin: 0;\n    padding: 0;\n    font-family: Arial, sans-serif;\n    background-color: #f5f5f5;\n}\n\n.app-container {\n    display: flex;\n    width: 100%;\n    height: 100vh;\n}\n\n.sidebar {\n    width: 17%;\n    padding: 0px;\n    background-color: #f8f9fa;\n    border-right: 1px solid #dee2e6;\n    overflow-y: auto;\n    display: flex;\n    flex-direction: column;\n}\n\n.main-content {\n    width: 83%;\n    padding: 0px;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n.file-input-container {\n    margin: 0px 10px 0px 10px;\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n    flex-shrink: 0;\n}\n\n.button-group {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    margin: 0px 0px;\n}\n\n.action-buttons-row {\n    display: flex;\n    gap: 10px;\n    width: 100%;\n}\n\n.action-buttons-row .btn {\n    flex: 1;\n}\n\n.source-lang-selector {\n    margin: 10px;\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n.select-input {\n    flex: 1;\n    padding: 5px;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n}\n\n.log-container {\n    margin-top: 5px;\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    min-height: 0;\n}\n\n.log-container h3 {\n    margin: 0 0 10px 0;\n    flex-shrink: 0;\n}\n\n.log-output {\n    flex: 1;\n    width: 99%;\n    height: 200px;\n    overflow-y: auto;\n    overflow-x: hidden;\n    background-color: #f8f9fa;\n    border: 1px solid #e9ecef;\n    border-radius: 4px;\n    padding: 0px;\n    font-family: monospace;\n    font-size: 12px;\n}\n\n.excel-table-container {\n    width: 100%;\n    height: 100%;\n    overflow: auto;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n    background-color: white;\n    flex: 1;\n}\n\n.table-output {\n    width: 100%;\n    height: 100%;\n    background-color: white;\n}\n\n.excel-table {\n    width: 100%;\n    border-collapse: collapse;\n    table-layout: fixed; /* 使用固定表格布局，确保单元格宽度限制生效 */\n    min-width: 100%;\n    border-spacing: 0; /* 消除单元格间的间距 */\n}\n\n/* 第一列（行号列）的样式 */\n.excel-table td:first-child,\n.excel-table th:first-child {\n    min-width: 50px;\n    max-width: 80px;\n    text-align: center;\n    background-color: #f8f9fa;\n}\n\n.excel-table th,\n.excel-table td {\n    border: 1px solid #ddd;\n    padding: 8px;\n    text-align: left;\n    min-width: 100px;\n    max-width: 200px; /* 设置最大宽度为200px */\n    width: 200px; /* 固定宽度为200px */\n    white-space: normal;\n    word-wrap: break-word;\n    word-break: break-word; /* 允许在单词内部换行 */\n    overflow: visible; /* 改为可见，确保内容不被裁剪 */\n    height: auto !important; /* 高度自动调整，使用!important确保优先级 */\n    vertical-align: top; /* 内容顶部对齐 */\n    line-height: 1.5; /* 增加行高，使文本更易读 */\n    box-sizing: border-box; /* 确保内边距和边框不会增加元素宽度 */\n}\n\n.excel-table th {\n    background-color: #f8f9fa;\n    font-weight: bold;\n    position: sticky;\n    top: 0;\n    z-index: 10; /* 增加z-index确保表头始终在最上层 */\n    box-shadow: 0 2px 2px -1px rgba(0,0,0,0.1); /* 添加阴影增强视觉效果 */\n}\n\n.excel-table tr:nth-child(even) {\n    background-color: #f8f9fa;\n}\n\n.excel-table tr:hover {\n    background-color: #f5f5f5;\n}\n\n.upload-section {\n    border: 2px dashed #ccc;\n    padding: 20px;\n    text-align: center;\n    border-radius: 8px;\n    transition: all 0.3s ease;\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n}\n\n.upload-section.drag-over {\n    border-color: #2196F3;\n    background-color: rgba(33, 150, 243, 0.1);\n}\n\n.upload-hint {\n    color: #666;\n    margin: 0;\n    font-size: 14px;\n    transition: all 0.3s ease;\n}\n\n.upload-section.has-file .upload-hint {\n    font-size: 12px;\n    color: #999;\n}\n\n.file-name {\n    margin: 10px 0;\n    font-size: 14px;\n    color: #666;\n}\n\n/* 源语言选择器样式 */\n.source-lang-selector label {\n    color: #333;\n    font-size: 14px;\n    min-width: 70px;\n}\n\n/* 添加样式使单元格内容过多时能正确显示 */\n.excel-table tr {\n    height: auto !important; /* 行高自动调整 */\n}\n\n/* 确保长文本在单元格中正确换行 */\n.excel-table td div,\n.excel-table td span,\n.excel-table td p,\n.excel-table td {\n    max-width: 100%;\n    word-wrap: break-word;\n    word-break: break-word;\n    white-space: pre-wrap; /* 保留空白并允许换行 */\n    text-overflow: ellipsis; /* 文本过长时显示省略号 */\n}\n\n.select-input {\n    flex: 1;\n    padding: 8px 12px;\n    border: 1px solid #2196F3;\n    border-radius: 4px;\n    font-size: 14px;\n    color: #333;\n    background-color: white;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\n.select-input:hover {\n    border-color: #1976D2;\n}\n\n.select-input:focus {\n    outline: none;\n    border-color: #1976D2;\n    box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.1);\n}\n\n/* 按钮基础样式 */\n.btn {\n    padding: 8px 16px;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    background-color: #2196F3;\n    color: white;\n    transition: background-color 0.3s;\n}\n\n.btn:hover {\n    background-color: #1976D2;\n}\n\n.btn:active {\n    background-color: #1565C0;\n}\n\n.btn:disabled {\n    background-color: #cccccc;\n    cursor: not-allowed;\n}\n\n/* 停止按钮样式 */\n.stop-btn {\n    background-color: #dc3545;\n    color: white;\n}\n\n.stop-btn:hover {\n    background-color: #c82333;\n}\n\n/* 翻译按钮样式 */\n.translate-btn {\n    padding: 8px 16px;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    background-color: #4CAF50;\n    color: white;\n    transition: background-color 0.3s;\n}\n\n.translate-btn:hover {\n    background-color: #45a049;\n}\n\n.translate-btn:disabled {\n    background-color: #cccccc;\n    cursor: not-allowed;\n}\n\n/* 保存按钮样式 */\n#saveBtn, #saveJson {\n    background-color: #4CAF50;\n}\n\n#saveBtn:hover, #saveJson:hover {\n    background-color: #388E3C;\n}\n\n#saveExcel {\n    background-color: #4CAF50;\n}\n\n#saveExcel:hover {\n    background-color: #388E3C;\n}\n\n/* 进度条容器样式 */\n.progress-wrapper {\n    margin: 5px;\n    width: 95%;\n}\n\n.progress-container {\n    width: 100%;\n    height: 20px;\n    background-color: #f0f0f0;\n    border-radius: 4px;\n    overflow: hidden;\n    border: 1px solid #ddd;\n    position: relative;\n}\n\n.progress-fill {\n    height: 100%;\n    width: 0;\n    background-color: #4CAF50;\n    transition: width 0.3s ease;\n}\n\n.progress-text {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n    color: #333;\n    font-size: 12px;\n    z-index: 1;\n}\n\n.progress-details {\n    margin-top: 5px;\n    font-size: 12px;\n    color: #666;\n    text-align: center;\n}\n\n.log-container h3 {\n    margin: 0 0 10px 0;\n    color: #333;\n    font-size: 14px;\n}\n\n.log-entry {\n    margin: 5px 0;\n    padding: 5px;\n    border-radius: 3px;\n    word-wrap: break-word;\n}\n\n.log-entry .timestamp {\n    color: #666;\n    margin-right: 8px;\n}\n\n.log-entry.error {\n    color: #dc3545;\n    background-color: rgba(220, 53, 69, 0.1);\n}\n\n.log-entry.warning {\n    color: #ffc107;\n    background-color: rgba(255, 193, 7, 0.1);\n}\n\n.log-entry.success {\n    color: #28a745;\n    background-color: rgba(40, 167, 69, 0.1);\n}\n\n.excel-table th {\n    background-color: #f8f9fa;\n    font-weight: bold;\n}\n\n.excel-table tr:nth-child(even) {\n    background-color: #f8f9fa;\n}\n\n.excel-table tr:hover {\n    background-color: #f5f5f5;\n}\n\n.table-scroll-container {\n    width: 100%;\n    height: 100%;\n    overflow: auto;\n}\n\n.table-scroll-x {\n    width: 100%;\n    overflow-x: auto;\n}\n\n.table-scroll-y {\n    height: 100%;\n    overflow-y: auto;\n}\n\n.container {\n    display: flex;\n    flex-direction: column;\n    min-height: 100vh;\n    padding: 20px;\n    box-sizing: border-box;\n}\n\n.content-wrapper {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n}\n\n.timestamp {\n    color: #666;\n    font-size: 0.9em;\n    margin-right: 8px;\n}\n\n.error {\n    color: #cc0000;\n    padding: 10px;\n    margin: 10px 0;\n    background-color: #ffe8e8;\n    border: 1px solid #ffcccc;\n    border-radius: 4px;\n}\n\n.progress-container {\n    margin: 10px 0;\n    width: 100%;\n}\n\n.progress-bar {\n    width: 100%;\n    height: 20px;\n    background-color: #f0f0f0;\n    border-radius: 10px;\n    overflow: hidden;\n}\n\n.progress {\n    height: 100%;\n    background-color: #4CAF50;\n    transition: width 0.3s ease-in-out;\n}\n\n.progress-text {\n    margin-top: 5px;\n    text-align: center;\n    color: #666;\n    font-size: 14px;\n}\n",""]);const a=i},6322:(n,t,e)=>{"use strict";var o=e(5072),r=e.n(o),s=e(7825),i=e.n(s),a=e(7659),l=e.n(a),c=e(5056),d=e.n(c),h=e(540),g=e.n(h),p=e(1113),u=e.n(p),x=e(365),f={};f.styleTagTransform=u(),f.setAttributes=d(),f.insert=l().bind(null,"head"),f.domAPI=i(),f.insertStyleElement=g(),r()(x.A,f),x.A&&x.A.locals&&x.A.locals;var b=e(4451),m=function(n,t,e,o){return new(e||(e=Promise))((function(r,s){function i(n){try{l(o.next(n))}catch(n){s(n)}}function a(n){try{l(o.throw(n))}catch(n){s(n)}}function l(n){var t;n.done?r(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(i,a)}l((o=o.apply(n,t||[])).next())}))};class y{constructor(n,t){this.apiEndpoint="https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",this.shouldStopTranslation=!1,this.apiKey=n||"sk-f3488cc61842433194d9ac397e52e548",this.logCallback=t||console.log,this.apiKey&&console.log("已成功加载API密钥")}stopTranslation(){this.shouldStopTranslation=!0}resetStopFlag(){this.shouldStopTranslation=!1}translateBatch(n,t){return m(this,void 0,void 0,(function*(){var e,o,r;try{const s=n.tasks.map((n=>n.rowIndex+3)),i=Math.min(...s),a=Math.max(...s),l=i===a?`第 ${i} 行`:`第 ${i} 行到第 ${a} 行`,c=n.tasks.length>0?n.tasks[0].targetLang:"未知";this.logCallback(`开始翻译批次 ${n.batchId} - ${t} 到 ${c} - ${l} - ${n.tasks.length}个任务`,"info"),(!this.apiKey||"string"==typeof this.apiKey&&""===this.apiKey.trim())&&(this.apiKey="sk-f3488cc61842433194d9ac397e52e548",console.log("从环境变量获取到API密钥"));const d=n.tasks.filter((n=>{try{if("string"!=typeof n.text){if(console.error("警告: 任务文本不是字符串，类型为 "+typeof n.text),null===n.text||void 0===n.text)return!1;n.text=String(n.text)}return""!==n.text.trim()}catch(t){return console.error("过滤任务时出错:",t,n),!1}}));if(0===d.length)return this.logCallback("批次中没有有效的翻译任务","warning"),!1;if(this.shouldStopTranslation)return console.log("翻译被用户停止"),this.logCallback("翻译被用户停止","warning"),!1;try{if(0===d.length)return this.logCallback("没有有效的翻译任务","warning"),!1;console.log(`翻译批次 - 目标语言: ${d[0].targetLang}, 共${d.length}个任务`),d[0].targetLang;const s=yield fetch(this.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${"string"==typeof this.apiKey?this.apiKey.trim():this.apiKey}`,Accept:"application/json"},body:JSON.stringify({model:"qwen-mt-turbo",messages:[{role:"user",content:d.map((n=>n.text)).join("\n")}],translation_options:{source_lang:t,target_lang:d[0].targetLang},temperature:.7,max_tokens:2e3})});if(!s.ok){const n=yield s.text();throw console.error(`翻译API错误 - 状态码: ${s.status}, 错误信息:`,n),this.logCallback(`翻译API错误: ${s.status} - ${n}`,"error"),new Error(`翻译API错误: ${s.status}`)}const i=yield s.text(),a=JSON.parse(i);if(!(null===(r=null===(o=null===(e=a.choices)||void 0===e?void 0:e[0])||void 0===o?void 0:o.message)||void 0===r?void 0:r.content))throw console.error("翻译返回数据格式错误:",a),this.logCallback("翻译返回数据格式错误","error"),new Error("翻译返回数据格式错误");const l=a.choices[0].message.content,c="string"==typeof l?l.trim().split("\n"):[String(l)];console.log(`收到 ${c.length} 行翻译结果，共 ${d.length} 个任务`);const h=Math.min(c.length,d.length);for(let n=0;n<h;n++){const t=c[n];d[n].text="string"==typeof t?t.trim():String(t),console.log(`翻译成功 - 行号: ${d[n].rowIndex+1}, 译文: ${d[n].text}`)}if(c.length<d.length){const n=d.length-c.length;this.logCallback(`警告: ${n} 个任务没有收到翻译结果`,"warning")}return n.success=!0,!0}catch(t){return console.error(`批量翻译失败 - 批次 ${n.batchId}`,t),console.error("批次任务详情:",n.tasks.map((n=>({rowIndex:n.rowIndex,text:n.text,textType:typeof n.text})))),this.logCallback(`批次 ${n.batchId} 翻译失败: ${t.message||t}`,"error"),n.success=!1,!1}n.completed=n.tasks.length}catch(t){return console.error("批次翻译失败:",t),console.error("错误堆栈:",t.stack||"无堆栈信息"),console.error("批次详细信息:",{batchId:n.batchId,taskCount:n.tasks.length,tasks:n.tasks.map((n=>({rowIndex:n.rowIndex,text:n.text?n.text:null,textType:typeof n.text})))}),this.logCallback(`批次翻译失败: ${t.message||t}`,"error"),n.success=!1,!1}}))}processBatches(n,t,e,o){return m(this,void 0,void 0,(function*(){const r=n.length;let s=0;this.logCallback(`开始处理 ${r} 个翻译批次`,"info");for(let i=0;i<n.length;i++){if(this.shouldStopTranslation){this.logCallback("翻译已被用户停止","warning");break}const a=n[i],l=i+1;e({completedBatches:s,totalBatches:r,currentBatchId:l,completedTasksInCurrentBatch:0,totalTasksInCurrentBatch:a.tasks.length});try{const n=yield this.translateBatch(a,t);s++,e({completedBatches:s,totalBatches:r,currentBatchId:0,completedTasksInCurrentBatch:a.tasks.length,totalTasksInCurrentBatch:a.tasks.length}),n&&o&&o(a),this.logCallback(`批次 ${l}/${r} 完成`,"success")}catch(n){this.logCallback(`批次 ${l}/${r} 失败`,"error")}}this.logCallback(`翻译任务完成: ${s}/${r} 个批次`,s===r?"success":"warning")}))}}class w{constructor(){var n;this.progressContainer=document.querySelector(".progress-container"),this.progressFill=document.querySelector(".progress-fill"),this.progressText=document.querySelector(".progress-text"),this.progressDetails=document.querySelector(".progress-details"),this.progressBatchCounter=document.createElement("div"),this.progressBatchCounter.className="progress-batch-counter",this.progressBatchCounter.style.textAlign="center",this.progressBatchCounter.style.marginTop="5px",this.progressBatchCounter.style.fontSize="14px",this.progressBatchCounter.style.color="#666",null===(n=this.progressContainer.parentNode)||void 0===n||n.insertBefore(this.progressBatchCounter,this.progressContainer.nextSibling)}updateProgress(n){const t=n.current/n.total*100;this.progressFill.style.width=`${t}%`,this.progressText.textContent=`${Math.round(t)}%`,n.text&&(this.progressDetails.textContent=n.text)}updateBatchProgress(n){const t=n.completedBatches/n.totalBatches*100;if(this.progressFill.style.width=`${t}%`,this.progressText.textContent=`${Math.round(t)}%`,this.progressBatchCounter.textContent=`批次进度: ${n.completedBatches}/${n.totalBatches}`,n.currentBatchId>0){const t=n.completedTasksInCurrentBatch/n.totalTasksInCurrentBatch*100;this.progressDetails.textContent=`当前批次 ${n.currentBatchId}/${n.totalBatches}: 完成 ${Math.round(t)}%`}}reset(){this.progressFill.style.width="0%",this.progressText.textContent="0%",this.progressDetails.textContent=""}show(){this.progressContainer.style.display="block"}hide(){this.progressContainer.style.display="none"}}var k=function(n,t,e,o){return new(e||(e=Promise))((function(r,s){function i(n){try{l(o.next(n))}catch(n){s(n)}}function a(n){try{l(o.throw(n))}catch(n){s(n)}}function l(n){var t;n.done?r(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(i,a)}l((o=o.apply(n,t||[])).next())}))};window.excelTranslatorInstance=new class{constructor(){this.tableOutput=null,this.data={},this.currentSheet="",this.sourceLangSelect=null,this.apiKey="",this.currentFileName="",this.originalWorkbook=null,this.shouldStopTranslation=!1,this.sourceColumnIndex=-1,this.targetLanguages=[],this.targetColumnIndices=[],this.sourceLanguages=["简体中文","英语"],this.languageMappings=[{columnHeader:"英语",targetLang:"English"},{columnHeader:"日语",targetLang:"Japanese"},{columnHeader:"韩语",targetLang:"Korean"},{columnHeader:"西班牙语",targetLang:"Spanish"},{columnHeader:"法语",targetLang:"French"},{columnHeader:"德语",targetLang:"German"},{columnHeader:"俄语",targetLang:"Russian"},{columnHeader:"泰语",targetLang:"Thai"},{columnHeader:"意大利语",targetLang:"Italian"},{columnHeader:"印尼语",targetLang:"Indonesian"},{columnHeader:"葡萄牙语",targetLang:"Portuguese"}],this.sourceLanguageConfig={简体中文:"Chinese",英语:"English"},this.batchSize=10,this.currentBatchNumber=0,this.tableOutput=document.getElementById("tableOutput"),this.progressBar=new w,window.excelTranslatorInstance?console.log("检测到已存在实例，跳过事件监听器初始化"):(this.initializeEventListeners(),this.initializeUI(),console.log("初始化事件监听器和UI")),this.apiKey="sk-f3488cc61842433194d9ac397e52e548",console.log("已从环境变量加载API密钥");const n=document.getElementById("apiKeyInput");if(n){if(this.apiKey){const t=this.apiKey.substring(0,4)+"..."+this.apiKey.substring(this.apiKey.length-4);n.value=t,n.setAttribute("placeholder","使用环境变量中的API密钥")}n.addEventListener("change",(t=>{const e=t.target.value;e&&e!==n.getAttribute("placeholder")&&(this.apiKey=e,console.log("已使用手动输入的API密钥"))}))}}translateCell(n,t){return k(this,void 0,void 0,(function*(){const e=document.getElementById("sourceLang"),o=(null==e?void 0:e.value)||"zh-CN",r=this.sourceLanguageConfig["en"===o?"英语":"简体中文"];console.log(`翻译请求 - 源语言: ${r}, 目标语言: ${t}, 文本: ${n}`);try{const e=yield fetch("https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey.trim()}`,Accept:"application/json"},body:JSON.stringify({model:"qwen-mt-turbo",messages:[{role:"user",content:n}],translation_options:{source_lang:r,target_lang:t},temperature:.7,max_tokens:2e3})});if(!e.ok){const n=yield e.text();throw console.error(`翻译API错误 - 状态码: ${e.status}, 错误信息:`,n),this.log(`翻译API错误: ${e.status} - ${n}`,"error"),new Error(`翻译API错误: ${e.status}`)}return(yield e.json()).choices[0].message.content.trim()}catch(n){throw console.error("翻译出错:",n),this.log(`翻译出错: ${n.message}`,"error"),n}}))}handleFileSelect(n){return k(this,void 0,void 0,(function*(){const t=n.target;if(t.files&&t.files[0])try{this.log("正在读取Excel文件...","info");const n=t.files[0],e=yield function(n){return new Promise(((t,e)=>{const o=new FileReader;o.onload=n=>{var o;try{const e=null===(o=n.target)||void 0===o?void 0:o.result,r=b.read(e,{type:"binary"}),s={};r.SheetNames.forEach((n=>{const t=r.Sheets[n],e=b.utils.sheet_to_json(t,{header:1}),o=e.slice(0,2),i=e.slice(2);s[n]={headerRows:o,rows:i}})),t(s)}catch(n){e(n)}},o.onerror=()=>{e(new Error("文件读取失败"))},o.readAsBinaryString(n)}))}(n);this.data=e,this.currentFileName=n.name;const o=document.getElementById("fileName");if(o&&(o.textContent=n.name),this.log(`成功读取Excel文件: ${n.name}`,"success"),this.log(`工作表数量: ${Object.keys(e).length}`,"info"),this.tableOutput=document.getElementById("tableOutput"),!this.tableOutput)return console.error("表格容器元素不存在"),void this.log("无法找到表格容器元素","error");this.updateSheetSelector(Object.keys(e)),Object.keys(e).length>0&&(this.currentSheet=Object.keys(e)[0],this.log(`显示工作表: ${this.currentSheet}`,"info"),this.displaySheet())}catch(n){console.error("Error reading Excel file:",n),this.log("读取Excel文件失败","error")}}))}handleTranslateClick(){return k(this,void 0,void 0,(function*(){const n=document.getElementById("translateBtn"),t=document.getElementById("stopTranslateBtn");if(n.style.display="none",t.style.display="inline-block",this.progressBar.show(),t.disabled=!1,this.shouldStopTranslation=!1,this.currentBatchNumber=0,!this.apiKey||""===this.apiKey.trim())return this.log("错误：API密钥未设置","error"),n.style.display="inline-block",t.style.display="none",void this.progressBar.hide();const e=document.getElementById("sourceLang");let o="简体中文",r="Chinese";"en"===((null==e?void 0:e.value)||"zh-CN")&&(o="英语",r="English");const{headerRows:s}=this.data[this.currentSheet];if(0===s.length)return this.log("错误：找不到表头行","error"),n.style.display="inline-block",t.style.display="none",void this.progressBar.hide();const i=s[1];let a=-1;for(let n=0;n<i.length;n++)if(i[n]===o){a=n;break}if(-1===a)return this.log(`错误：在表头中找不到源语言 "${o}" 列`,"error"),n.style.display="inline-block",t.style.display="none",void this.progressBar.hide();const l=[];for(let n=0;n<i.length;n++){if(n===a)continue;const t=this.languageMappings.find((t=>t.columnHeader===i[n]));if(t){if("英语"===o&&"简体中文"===i[n])continue;l.push({index:n,langCode:t.targetLang,display:t.columnHeader})}}if(0===l.length)return this.log("错误：找不到任何目标语言列","error"),n.style.display="inline-block",t.style.display="none",void this.progressBar.hide();this.log(`开始翻译，源语言: ${o} (列 ${this.getExcelColumnName(a)})`,"info"),this.log("目标语言: "+l.map((n=>`${n.display} (列 ${this.getExcelColumnName(n.index)})`)).join(", "),"info");const c=this.data[this.currentSheet].rows;try{const e=[];this.log("正在收集需要翻译的内容...","info");for(let n=0;n<c.length;n++){const t=c[n];for(;t.length<=Math.max(...l.map((n=>n.index)));)t.push("");const o=t[a];try{if(!o||"string"==typeof o&&""===o.trim()){this.log(`跳过第 ${n+1} 行：源文本为空`,"warning");continue}"string"!=typeof o&&(this.log(`警告: 第 ${n+1} 行的源文本不是字符串，尝试转换`,"warning"),t[a]=String(o))}catch(t){console.error(`处理行 ${n+1} 列 ${a} 的源文本时出错:`,t),this.log(`警告: 处理行 ${n+1} 列 ${a} 时出错，跳过该行`,"warning");continue}for(const r of l){try{const n=t[r.index];if(null!=n&&"string"==typeof n&&""!==n.trim())continue}catch(t){console.error(`处理行 ${n+1} 列 ${r.index} 时出错:`,t),this.log(`警告: 处理行 ${n+1} 列 ${r.index} 时出错`,"warning")}e.push({text:o,targetLang:r.langCode,rowIndex:n,columnIndex:a,targetColumnIndex:r.index,langDisplay:r.display})}}if(0===e.length)return this.log("没有找到需要翻译的内容","warning"),n.style.display="inline-block",t.style.display="none",void this.progressBar.hide();this.log(`找到 ${e.length} 个需要翻译的单元格`,"info");const o=[];let s=1;const i={};for(const n of e)i[n.targetLang]||(i[n.targetLang]=[]),i[n.targetLang].push(n);this.log(`已将翻译任务分组为 ${Object.keys(i).length} 种目标语言`,"info");for(const n in i){const t=i[n],e=t[0].langDisplay;this.log(`处理目标语言 ${e} 的 ${t.length} 个任务`,"info");let r=[],a=0;const l=2e3,c=20;for(let n=0;n<t.length;n++){const e=t[n];if((r.length>=c||a+("string"==typeof e.text?e.text.length:0)>l)&&r.length>0){const n={tasks:[...r],batchId:s++,totalCharCount:a};o.push(n),r=[],a=0}if(e.text.length>l){this.log(`警告: 任务字符数(${e.text.length})超过限制(${l})，单独处理`,"warning");const n={tasks:[e],batchId:s++,totalCharCount:e.text.length};o.push(n)}else r.push(e),a+=e.text.length}if(r.length>0){const n={tasks:r,batchId:s++,totalCharCount:a};o.push(n)}}this.log(`将翻译任务分成了 ${o.length} 个批次`,"info");const d=new y(this.apiKey,this.log.bind(this));t.onclick=()=>{this.shouldStopTranslation=!0,d.stopTranslation(),t.disabled=!0,this.log("正在停止翻译...","warning")},yield d.processBatches(o,r,(n=>{this.progressBar.updateBatchProgress(n)}),(n=>{let t=0;for(const e of n.tasks)e.text&&"string"==typeof e.text&&""!==e.text.trim()?(c[e.rowIndex][e.targetColumnIndex]=e.text,this.updateCellInDOM(e.rowIndex+2,e.targetColumnIndex,e.text)):t++;t>0&&this.log(`警告: ${t} 个任务没有收到翻译结果`,"warning");const e=n.tasks.length>0?n.tasks[0].langDisplay:"";this.log(`已更新 ${e} 的翻译结果`,"info")})),this.log("所有翻译任务完成","success")}catch(n){const t=n.message||String(n),e=n.stack||"No stack trace available";console.error("翻译过程出错:",n),console.error("错误堆栈:",e);try{const n=e.split("\n").slice(0,3).join("\n");this.log(`翻译过程出错: ${t}\n${n}`,"error")}catch(n){this.log(`翻译过程出错: ${t}`,"error"),console.error("解析错误堆栈时出错:",n)}}finally{n.style.display="inline-block",t.style.display="none",t.disabled=!0,this.progressBar.hide()}}))}createBatches(n,t){const e=[];for(let o=0;o<n.length;o+=t)e.push(n.slice(o,o+t));return e}initializeUI(){this.progressBar.show(),this.progressBar.updateProgress({current:0,total:100}),this.progressBar.hide();const n=document.getElementById("stopTranslateBtn");n&&n.addEventListener("click",(()=>{this.shouldStopTranslation=!0,n.disabled=!0,this.log("正在停止翻译...","warning")}))}initializeEventListeners(){const n=document.getElementById("fileInput"),t=document.getElementById("uploadBtn"),e=document.getElementById("translateBtn"),o=document.getElementById("exportBtn"),r=document.getElementById("actionButtons");this.sourceLangSelect=document.getElementById("sourceLang"),t&&t.addEventListener("click",(()=>{null==n||n.click()})),n&&n.addEventListener("change",(n=>{this.handleFileSelect(n),r&&(r.style.display="block")})),e&&e.addEventListener("click",(()=>this.handleTranslateClick())),o&&o.addEventListener("click",(()=>this.exportToExcel()))}exportToExcel(){return k(this,void 0,void 0,(function*(){if(this.currentSheet&&this.data[this.currentSheet])try{const n=function(n){const t=b.utils.book_new();return Object.entries(n).forEach((([n,e])=>{const o=[...e.headerRows,...e.rows],r=b.utils.aoa_to_sheet(o);b.utils.book_append_sheet(t,r,n)})),t}(this.data);b.writeFile(n,`${this.currentFileName.replace(".xlsx","")}_translated.xlsx`),this.log("导出成功","success")}catch(n){n instanceof Error?this.log(`导出失败: ${n.message}`,"error"):this.log("导出失败: 未知错误","error")}else this.log("没有可导出的数据","warning")}))}getExcelColumnName(n){let t="";for(;n>=0;)t=String.fromCharCode(65+n%26)+t,n=Math.floor(n/26)-1;return t}log(n,t="info"){const e=document.getElementById("logOutput");if(!e)return;const o=document.createElement("div");o.className=`log-entry ${t}`,o.textContent=`[${(new Date).toLocaleTimeString()}] ${n}`,e.appendChild(o),e.scrollTop=e.scrollHeight}updateSheetSelector(n){const t=document.getElementById("sheetSelector");t&&(t.innerHTML="",n.forEach((n=>{const e=document.createElement("option");e.value=n,e.textContent=n,t.appendChild(e)})))}updateCellInDOM(n,t,e){const o=document.getElementById("tableOutput");if(!o)return;const r=o.querySelector(".table-wrapper");if(!r)return;const s=r.querySelector("table");if(!s)return;const{headerRows:i}=this.data[this.currentSheet];if(n<i.length)return;const a=s.querySelectorAll("tr");let l;for(let t=0;t<a.length;t++){const e=a[t],o=e.querySelector(".row-number");if(o&&o.textContent===(n+1).toString()){l=e;break}}if(l&&t+1<l.children.length){const n=l.children[t+1];n&&(n.textContent=e)}}displaySheet(){if(this.tableOutput=document.getElementById("tableOutput"),!this.tableOutput||!this.currentSheet||!this.data[this.currentSheet])return void console.error("无法显示表格：",{tableOutput:!!this.tableOutput,currentSheet:this.currentSheet,hasData:!!this.data[this.currentSheet]});this.tableOutput.innerHTML="";const n=document.createElement("div");n.className="table-wrapper";const t=document.createElement("table");t.className="excel-table";const{headerRows:e,rows:o}=this.data[this.currentSheet],r=[...e,...o],s=Math.max(...e.map((n=>n.length)),...o.map((n=>n.length))),i=document.createElement("tr"),a=document.createElement("th");i.appendChild(a);for(let n=0;n<s;n++){const t=document.createElement("th");t.textContent=this.getExcelColumnName(n),t.className="column-header",i.appendChild(t)}t.appendChild(i),r.forEach(((n,r)=>{const i=document.createElement("tr");if(1!==r&&r<6)return void(i.style.display="none");const a=document.createElement("td");a.textContent=(r+1).toString(),a.className="row-number",i.appendChild(a);for(let t=0;t<s;t++){const s=document.createElement(r<e.length?"th":"td");s.textContent=n[t]||"",r>=e.length&&(s.contentEditable="true"),s.addEventListener("input",(()=>{if(r<e.length)e[r][t]=s.textContent||"";else{const n=r-e.length;for(;o.length<=n;)o.push([]);for(;o[n].length<=t;)o[n].push("");o[n][t]=s.textContent||""}})),i.appendChild(s)}t.appendChild(i)})),n.appendChild(t),this.tableOutput.appendChild(n);const l="fixed-table-style";if(!document.getElementById(l)){const n=document.createElement("style");n.id=l,n.textContent="\n                .table-wrapper {\n                    position: relative;\n                    overflow: auto;\n                    height: 99vh;\n                    max-width: 100%;\n                    border: 1px solid #ccc;\n                    margin: 1px;\n                    scroll-padding-top: 40px; /* 添加滚动填充，防止内容被固定头部遮挡 */\n                }\n                \n                .excel-table {\n                    border-collapse: collapse;\n                }\n                \n                .excel-table th, .excel-table td {\n                    border: 1px solid #ddd;\n                    padding: 8px;\n                    min-width: 100px;\n                }\n                \n                .excel-table th:first-child {\n                    position: sticky;\n                    left: 0;\n                    z-index: 3;\n                    background-color: #f2f2f2;\n                }\n                \n                .excel-table thead th {\n                    position: sticky;\n                    top: 0;\n                    z-index: 2;\n                    background-color: #f2f2f2;\n                    box-shadow: 0 1px 0 rgba(0,0,0,0.1); /* 添加底部阴影，增强视觉效果 */\n                }\n                \n                .excel-table tr:first-child th {\n                    position: sticky;\n                    top: 0;\n                    z-index: 2;\n                    background-color: #f2f2f2;\n                    box-shadow: 0 1px 0 rgba(0,0,0,0.1); /* 添加底部阴影，增强视觉效果 */\n                }\n                \n                /* 处理左上角单元格，同时固定在顶部和左侧 */\n                .excel-table tr:first-child th:first-child {\n                    position: sticky;\n                    top: 0;\n                    left: 0;\n                    z-index: 4; /* 最高层级，确保始终显示在最上层 */\n                    background-color: #f2f2f2;\n                    box-shadow: 1px 1px 0 rgba(0,0,0,0.1); /* 添加右侧和底部阴影 */\n                }\n                \n                .excel-table .row-number {\n                    position: sticky;\n                    left: 0;\n                    z-index: 1;\n                    background-color: #f2f2f2;\n                }\n            ",document.head.appendChild(n)}}}}},e={};function o(n){var r=e[n];if(void 0!==r)return r.exports;var s=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(s.exports,s,s.exports,o),s.loaded=!0,s.exports}o.m=t,n=[],o.O=(t,e,r,s)=>{if(!e){var i=1/0;for(d=0;d<n.length;d++){for(var[e,r,s]=n[d],a=!0,l=0;l<e.length;l++)(!1&s||i>=s)&&Object.keys(o.O).every((n=>o.O[n](e[l])))?e.splice(l--,1):(a=!1,s<i&&(i=s));if(a){n.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=n.length;d>0&&n[d-1][2]>s;d--)n[d]=n[d-1];n[d]=[e,r,s]},o.n=n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return o.d(t,{a:t}),t},o.d=(n,t)=>{for(var e in t)o.o(t,e)&&!o.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:t[e]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(n){if("object"==typeof window)return window}}(),o.o=(n,t)=>Object.prototype.hasOwnProperty.call(n,t),o.nmd=n=>(n.paths=[],n.children||(n.children=[]),n),(()=>{var n={792:0};o.O.j=t=>0===n[t];var t=(t,e)=>{var r,s,[i,a,l]=e,c=0;if(i.some((t=>0!==n[t]))){for(r in a)o.o(a,r)&&(o.m[r]=a[r]);if(l)var d=l(o)}for(t&&t(e);c<i.length;c++)s=i[c],o.o(n,s)&&n[s]&&n[s][0](),n[s]=0;return o.O(d)},e=self.webpackChunkexcel_to_structured_data=self.webpackChunkexcel_to_structured_data||[];e.forEach(t.bind(null,0)),e.push=t.bind(null,e.push.bind(e))})(),o.nc=void 0;var r=o.O(void 0,[121],(()=>o(6322)));r=o.O(r)})();